<!DOCTYPE html>
<html>
	<head>
		<script src="https://unpkg.com/chevrotain/lib/chevrotain.js"></script>
		<!--script src="https://unpkg.com/chevrotain/lib/chevrotain.min.js"></script-->
		<script src="./foo.js"></script>
		<script>
			function simplify(cst) {
				if (!cst.hasOwnProperty("name")) {
					return { 
						"name": "string", 
						"value": cst.image
					};
				} else if (cst.children.hasOwnProperty("neg")) {
					var negValue = {
						"name": "neg", 
						"value": simplify(cst.children["lhs"][0])
					};
					for (var i = 1; i < cst.children["neg"].length; ++i) {
						negValue = {
							"name": "neg",
							"value": negValue
						}
					}
					return negValue;
				} else if (cst.children.hasOwnProperty("rhs")) {
					var children = [simplify(cst.children["lhs"][0])];
					cst.children["rhs"].forEach((x) => {
						children.push(simplify(x));
					});
					return {
						"name": cst.children["mid"][0].image,
						"value": children
					};
				} else if (cst.children.hasOwnProperty("lhs")) {
					return simplify(cst.children["lhs"][0]);
				}
				throw Error("This is not permitted");
			}
			function prove(formula) {
				var simple = simplify(parse(formula).cst);
				document.getElementById("output").innerHTML = JSON.stringify(simple, undefined, 3) + "\n\n" + JSON.stringify(parse(formula).cst, undefined, 3);
			}
		</script>
	</head>
	<body>
		<div id="formula_input">
			<input id="formula"/>
			<button onclick="prove(document.getElementById('formula').value)">Prove</button>
		</div>
		<div id="formula_output">
			<pre id="output"></pre>
		</div>
	</body>
</html>