<!DOCTYPE html>
<html>
    <head>
        <link rel="shortcut icon" type="image/png" href="./img/home-icon.png"/>
        <script src="./lib/jquery.min.js" type="text/javascript"></script>
        <script src="./lib/d3.v4.js"></script>

        <style>
            #result_sets {
              margin: 5px;
              border: 0.5rem outset #716da7;
              border-radius: 12px;
              flex: 1 1 auto;
              padding: 10px;
            }

            #visualization-graph {
              width: 70%;
              aspect-ratio : 1 / 1;
              margin: 5px;
              border: 0.5rem outset #716da7;
              border-radius: 12px;
              font-family: sans-serif, Arial;  
              font-size: 12px;
              font-weight: bold;
            }
            .links line {   
              stroke: #999;
              stroke-opacity: 0.6;
            }

            .nodes circle {
              stroke: #fff;
              stroke-width: 1.5px;
              cursor: grab;
            }

            .node text {
              pointer-events: none;
              font: 10px sans-serif;
            }

            path {
              fill-opacity: .1;
              stroke-opacity: 1;
            }
        </style>
        <style>
            body {
              font-family: "Lato", sans-serif;
            }

            .sidenav {
              height: 100%;
              width: 14vw;
              position: fixed;
              z-index: 1;
              top: 0;
              left: 0;
              background-color: #d6d6f5;
              overflow-x: hidden;
              padding-top: 20px;
            }

            .sidenav a {
              padding: 6px 8px 6px 16px;
              text-decoration: none;
              font-size: 25px;
              color: #818181;
              display: block;
            }

            .sidenav a:hover {
              color: #f1f1f1;
            }

            .main {
              margin-left: 14vw; /* Same as the width of the sidenav */
              /* font-size: 28px;  Increased text to enable scrolling */
              padding: 0px 10px;
            }

            @media screen and (max-height: 450px) {
              .sidenav {padding-top: 15px;}
              .sidenav a {font-size: 18px;}
            }
        </style>

        <script>
            var serverOrigin = location.origin;
            var valid_op_id = null;

            // since now we are only posting tasks, these requests will be fast enough and
            // we can make them synchronous thus returning the result as soon as it comes.
            // this should be done better in an upcoming version.
            function is_satisfiable(formula) {
                document.getElementById("is_satisfied_output").innerHTML = "";
                document.getElementById("output").innerHTML = "";

                $.post(serverOrigin + "/satisfy", {
                        formula: formula
                    })
                    .done(function (data) {
                        console.log("good");
                    });
            }

            function post_task(formula, algorithm_type, formula_filters) {
                var params =
                    "?algorithm_type=" + algorithm_type +
                    "&formula_filters=" + formula_filters;
                return $.post(serverOrigin + "/task" + params, formula)
                // on error change_computing_components_availability
            }

            var running_count = 0;

            function ping_task(op_id, timer_id) {
                var params = "?op_id=" + valid_op_id;
                $.get(serverOrigin + "/rest/ping" + params, null)
                    .done(function (data) {
                        // depending on the data return RUNNING or CANCELED or FINISHED...
                        console.log(data);
                        var jsonified = JSON.parse(data.replace(/'/g, "\""));
                        if (jsonified["status"] == "FINISHED") {
                            clearInterval(timer_id);
                            valid_op_id = null;
                            document.getElementById('algorithm_result').innerText = jsonified["is_satisfied"] ? "Satisfiable" : "Not satisfiable";
                            document.getElementById('verbose_output').innerText += jsonified["output"];
                            graphis = transform_contacts_to_graph(jsonified);
                            do_visualization_v2(graphis, 500, 500);
                            print_result_sets(jsonified["variables"], jsonified["ids"]);
                            change_computing_components_availability(true)
                            running_count = 0;
                        } else if (jsonified["status"] == "CANCELED") {
                            clearInterval(timer_id);
                            valid_op_id = null;
                            document.getElementById('algorithm_result').innerText = "Canceled";
                            document.getElementById('verbose_output').innerText += jsonified["output"];
                            running_count = 0;
                            change_computing_components_availability(true)
                            // populate the output that the formula was canceled
                        } else if (jsonified["status"] == "RUNNING") {
                            // populate the verbose output
                            document.getElementById('verbose_output').innerText += jsonified["output"];
                            let dots = ".";
                            if (running_count % 3 == 2)
                                dots = "...";
                            else if (running_count % 3 == 1)
                                dots = ".."
                            running_count += 1;
                            document.getElementById('algorithm_result').innerText = "Running";
                        }
                    })
                    .fail(function () {
                        document.getElementById("verbose_output").innerText = "Sorry, the server is down, please try again after a few seconds.";
                        clearInterval(timer_id);
                        valid_op_id = null;
                        running_count = 0;
                        change_computing_components_availability(true);
                    });
            }

            function cancel_task(op_id, timer_id) {
                var params = "?op_id=" + valid_op_id;
                let cancel_btn = document.getElementById("cancel_calculation");
                cancel_btn.disabled = true;
                $.get(serverOrigin + "/rest/cancel" + params, null)
                    .done(function (data) {
                        // return true if success, return false if the task was already canceled
                        console.log('Cancel answer: ' + data);
                    })
                    .fail(function() {
                        document.getElementById("verbose_output").innerText = "Sorry, the server is down, not able to cancel the task.";
                        console.log("Unable to cancel a task because the server is down");
                        cancel_btn.disabled = false;
                    });
            }

            function create_task(algorithm_type) {
                var formula = document.getElementById('formula').value;
                if (!formula || !(algorithm_type == "MEASURED_MODEL" || algorithm_type == "OPTIMIZED_MEASURED_MODEL" || algorithm_type == "FAST_MODEL" || algorithm_type == "CONNECTIVITY" || algorithm_type == "BRUTEFORCE_MODEL")) {
                    return;
                }

                var formula_filters = get_formula_filters();

                document.getElementById("algorithm_result").innerText = "Running";
                document.getElementById("verbose_output").innerText = "";
                d3.select("svg").empty();
                d3.select("#visualization-graph").select("svg").remove();

                post_task(formula, algorithm_type, formula_filters)
                    .done(function (data) {
                        change_computing_components_availability(false);
                        valid_op_id = data;
                        console.log('Creating a task with algorithm: ' + algorithm_type + ' and op id: ' + valid_op_id);

                        function myFunction() {
                            var timer_id = setInterval(function () {
                                ping_task(valid_op_id, timer_id);
                            }, 1000);
                        };
                        myFunction();
                    })
                    .fail(function (data, xx, yyy) {
                        if (data.status === 429) {
                            document.getElementById("verbose_output").innerText = "There are too many requests right now, please try again later.";
                        }
                        else {
                            document.getElementById("verbose_output").innerText = "Sorry, the server is down, please try again after a few seconds.";
                        }
                    });

                // set ping on every few seconds it is best to have something like this for the ping delay [1, 2, 5, 7, 10, 10, ...
                // on ping result FINISHED show the result probably in the output area.
            }

            function change_computing_components_availability(enable) {
                var elems = document.getElementsByClassName("computing_element");
                for (var i = 0; i < elems.length; i++) {
                    elems[i].disabled = !enable;
                }
                var cancel_btn = document.getElementById("cancel_calculation");
                cancel_btn.disabled = enable; // cancel button should be enabled when the model buttons are disabled, i.e. when there is a runninng task
            }

            function get_formula_filters() {
                var x = []
                if (document.getElementById("convert_contact_less_eq_with_same_terms").checked) {
                    x.push("convert_contact_less_eq_with_same_terms");
                }
                if (document.getElementById("convert_disjunction_in_contact_less_eq").checked) {
                    x.push("convert_disjunction_in_contact_less_eq");
                }
                if (document.getElementById("reduce_constants").checked) {
                    x.push("reduce_constants");
                }
                if (document.getElementById("reduce_contacts_less_eq_with_constants").checked) {
                    x.push("reduce_contacts_less_eq_with_constants");
                }
                if (document.getElementById("remove_double_negation").checked) {
                    x.push("remove_double_negation")
                }

                return x
            }

            function transform_contacts_to_graph(data) {
                contacts = data["contacts"];
                ids = data["ids"];

                nodes_temp = [...Array(contacts.length).keys()]

                nodes = [];
                for (i = 0; i < nodes_temp.length; ++i) {
                    var x = nodes_temp[i];
                    nodes.push({
                        "id": x,
                        "name": "A" + x,
                        "groups": ids.map(a => a[i]).map((a, i) => a == 1 ? i : -1).filter(a => a >= 0)
                    });
                }


                links = [];

                for (i = 0; i < contacts.length; ++i) {
                    for (j = 0; j < contacts[i].length && j <= i; ++j) {
                        if (contacts[i][j] == "1") {
                            links.push({
                                "source": i,
                                "target": j
                            });
                        }
                    }
                }

                return {
                    "nodes": nodes,
                    "links": links
                }
            }

            function do_visualization_v2(graph, width, height) {
                d3.select("svg").empty();
                d3.select("#visualization-graph").select("svg").remove();
                
                var svg = d3.select('#visualization-graph').append('svg').attr("viewBox", [0, 0, width, height]),
                    // width = +svg.attr('width'),
                    // height = +svg.attr('height'),
                    color = d3.scaleOrdinal(d3.schemeCategory20),
                    valueline = d3.line()
                      .x(function(d) { return d[0]; })
                      .y(function(d) { return d[1]; })
                      .curve(d3.curveCatmullRomClosed),
                    paths,
                    groups,
                    groupIds,
                    scaleFactor = 1.8,
                    polygon,
                    centroid,
                    node,
                    link,
                    curveTypes = ['curveBasisClosed', 'curveCardinalClosed', 'curveCatmullRomClosed', 'curveLinearClosed'],
                    simulation = d3.forceSimulation()
                      .force('link', d3.forceLink().id(function(d) { return d.id; }))
                      .force('charge', d3.forceManyBody())
                      .force('center', d3.forceCenter(width / 2, height / 2));


                function start() {
                  // create selector for curve types
                  // var select = d3.select('#curveSettings')
                  //   .append('select')
                  //   .attr('class','select')
                  //   .on('change', function() {
                  //     var val = d3.select('select').property('value');
                  //     d3.select('#curveLabel').text(val);
                  //     valueline.curve(d3[val]);
                  //     updateGroups();
                  //   });
                  // var options = select
                  //   .selectAll('option')
                  //   .data(curveTypes).enter()
                  //   .append('option')
                  //     .text(function (d) { return d; });


                  // create groups, links and nodes
                  groups = svg.append('g').attr('class', 'groups');

                  link = svg.append('g')
                      .attr('class', 'links')
                    .selectAll('line')
                    .data(graph.links)
                    .enter().append('line')
                      .attr('stroke-width', function(d) { return 3; });

                  node = svg.append('g')
                      .attr('class', 'nodes')
                    .selectAll('circle')
                    .data(graph.nodes)
                    .enter().append('circle')
                      .attr('r', 4)
                      .attr('fill', function(d) { return color(1); })
                      .call(d3.drag()
                          .on('start', dragstarted)
                          .on('drag', dragged)
                          .on('end', dragended));

                  var label = svg.append('g')
                    .attr("class", "labels")
                    .selectAll("text")
                    .data(graph.nodes)
                    .enter().append("text")
                    .attr("class", "label")
                    .text(function (d) {
                        return d.name;
                    })
                    .call(d3.drag()
                        .on("start", dragstarted)
                        .on("drag", dragged)
                        .on("end", dragended));

                  // count members of each group. Groups with less
                  // than 3 member will not be considered (creating
                  // a convex hull need 3 points at least)
                  groupIds = [...new Set(graph.nodes.map(function(n) { return n.groups; }).flat())];
                    // .map( function(groupId) {
                    //   return { 
                    //     groupId : groupId,
                    //     count : graph.nodes.filter(function(n) { return n.group == groupId; }).length
                    //   };
                    // })
                    // //.filter( function(group) { return group.count > 2;})
                    // .map( function(group) { return group.groupId; });

                  paths = groups.selectAll('.path_placeholder')
                    .data(groupIds, function(d) { return +d; })
                    .enter()
                    .append('g')
                    .attr('class', 'path_placeholder')
                    .append('path')
                    .attr('stroke', function(d) { return color(d); })
                    .attr('fill', function(d) { return color(d); })
                    .attr('opacity', 0);

                  paths
                    .transition()
                    .duration(2000)
                    .attr('opacity', 1);

                  // add interaction to the groups
                  groups.selectAll('.path_placeholder')
                    .attr("cursor", "grab")
                    .call(d3.drag()
                      .on('start', group_dragstarted)
                      .on('drag', group_dragged)
                      .on('end', group_dragended)
                      );

                  // svg.call(d3.zoom()
                  //     .extent([
                  //         [0, 0],
                  //         [width, height]
                  //     ])
                  //     .scaleExtent([1, 8])
                  //     .on("zoom", zoomed));

                  simulation
                      .nodes(graph.nodes)
                      .on('tick', ticked)
                      .force('link')
                      .links(graph.links);

                  function ticked() {
                    link
                        .attr('x1', function(d) { return d.source.x; })
                        .attr('y1', function(d) { return d.source.y; })
                        .attr('x2', function(d) { return d.target.x; })
                        .attr('y2', function(d) { return d.target.y; });
                    node
                        .attr('cx', function(d) { return d.x; })
                        .attr('cy', function(d) { return d.y; });
                   
                    label
                        .attr("x", function (d) {
                            return d.x - 12;
                        })
                        .attr("y", function (d) {
                            return d.y - 5;
                        })
                        .style("font-size", "20px").style("fill", "#346f93");
                    updateGroups();
                  }
                };

                start();

                // select nodes of the group, retrieve its positions
                // and return the convex hull of the specified points
                // (3 points as minimum, otherwise returns null)
                var polygonGenerator = function(groupId) {
                  var node_coords = node
                    .filter(function(d) { return d.groups.includes(groupId); })
                    .data()
                    .map(function(d) { return [d.x, d.y]; });
                    
                  if (node_coords.length == 1) {
                    node_coords.push([node_coords[0][0] + 10, node_coords[0][1] + 10]);
                    node_coords.push([node_coords[0][0] + 10, node_coords[0][1] - 10]);
                    node_coords.push([node_coords[0][0] - 10, node_coords[0][1] + 10]);
                    node_coords.push([node_coords[0][0] - 10, node_coords[0][1] - 10]);
                  } else if (node_coords.length == 2) {
                    node_coords.push([(node_coords[0][0] + node_coords[1][0])/2 + 25, (node_coords[0][1] + node_coords[1][1])/2 + 25])
                  }
                  return d3.polygonHull(node_coords);
                };

                function updateGroups() {
                  groupIds.forEach(function(groupId) {
                    var path = paths.filter(function(d) { return d == groupId;})
                      .attr('transform', 'scale(1) translate(0,0)')
                      .attr('d', function(d) {
                        polygon = polygonGenerator(d);          
                        centroid = d3.polygonCentroid(polygon);

                        // to scale the shape properly around its points:
                        // move the 'g' element to the centroid point, translate
                        // all the path around the center of the 'g' and then
                        // we can scale the 'g' element properly
                        return valueline(
                          polygon.map(function(point) {
                            return [  point[0] - centroid[0], point[1] - centroid[1] ];
                          })
                        );
                      });

                    d3.select(path.node().parentNode).attr('transform', 'translate('  + centroid[0] + ',' + (centroid[1]) + ') scale(' + scaleFactor + ')');
                  });
                }

                // drag nodes
                function dragstarted(d) {
                  if (!d3.event.active) simulation.alphaTarget(0.3).restart();
                  d.fx = d.x;
                  d.fy = d.y;
                }

                function dragged(d) {
                  d.fx = d3.event.x;
                  d.fy = d3.event.y;
                }

                function dragended(d) {
                  if (!d3.event.active) simulation.alphaTarget(0);
                  d.fx = null;
                  d.fy = null;
                }

                // drag groups
                function group_dragstarted(groupId) {
                  if (!d3.event.active) simulation.alphaTarget(0.3).restart();
                  d3.select(this).select('path').style('stroke-width', 3);
                }

                function group_dragged(groupId) {
                  node
                    .filter(function(d) { return d.groups.includes(groupId); })
                    .each(function(d) {
                      d.x += d3.event.dx;
                      d.y += d3.event.dy;
                    })
                }

                function group_dragended(groupId) {
                  if (!d3.event.active) simulation.alphaTarget(0.3).restart();
                  d3.select(this).select('path').style('stroke-width', 1);
                }

                function zoomed() {
                    d3.selectAll('g').attr("transform", d3.event.transform);
                };
            }

            function print_result_sets(variables, ids) {
                var text = "";
                all_strings = variables.map((x, i) => "v(" + x + ") =  { " + 
                    ids[i].map((a, i) => a == 1 ? i : -1)
                    .filter(a => a >= 0)
                    .map(x => "A" + x + " ")
                     + "}");
                all_strings.forEach(x => text += x + "\n");
                document.getElementById("result_sets").innerText = text;
            }

            function do_visualization(graph, width, height) {
                d3.select("svg").empty();
                d3.select("#visualization-graph").select("svg").remove();

                var svg = d3.select("#visualization-graph")
                    .append("svg")
                    .attr("viewBox", [0, 0, width, height]);

                var simulation = d3.forceSimulation()
                    .force("link", d3.forceLink().id(function (d) {
                        return d.id;
                    }))
                    .force("charge", d3.forceManyBody().strength(-150))
                    .force("center", d3.forceCenter(width / 2, height / 2))
                    .force('collision', d3.forceCollide().radius(function (d) {
                        return 25
                    }));

                const g = svg.append("g")
                    .attr("cursor", "grab");

                var link = g.append("g")
                    .style("stroke", "#aaa")
                    .selectAll("line")
                    .data(graph.links)
                    .enter().append("line");

                var node = g.append("g")
                    .attr("class", "nodes")
                    .selectAll("circle")
                    .data(graph.nodes)
                    .enter()
                    .append("circle")
                    .attr("r", 6)
                    .attr("cx", ({
                        x
                    }) => x)
                    .attr("cy", ({
                        y
                    }) => y)
                    .call(d3.drag()
                        .on("start", dragstarted)
                        .on("drag", dragged)
                        .on("end", dragended));

                var label = g.append("g")
                    .attr("class", "labels")
                    .selectAll("text")
                    .data(graph.nodes)
                    .enter().append("text")
                    .attr("class", "label")
                    .text(function (d) {
                        return d.name;
                    })
                    .call(d3.drag()
                        .on("start", dragstarted)
                        .on("drag", dragged)
                        .on("end", dragended));

                svg.call(d3.zoom()
                    .extent([
                        [0, 0],
                        [width, height]
                    ])
                    .scaleExtent([1, 8])
                    .on("zoom", zoomed));

                simulation
                    .nodes(graph.nodes)
                    .on("tick", ticked);

                simulation.force("link")
                    .links(graph.links);

                function ticked() {
                    console.log("in Tick");
                    link
                        .attr("x1", function (d) {
                            return d.source.x;
                        })
                        .attr("y1", function (d) {
                            return d.source.y;
                        })
                        .attr("x2", function (d) {
                            return d.target.x;
                        })
                        .attr("y2", function (d) {
                            return d.target.y;
                        });

                    node
                        .attr("r", 20)
                        .style("fill", "#d9d9d9")
                        .style("stroke", "#969696")
                        .style("stroke-width", "1px")
                        .attr("cx", function (d) {
                            return d.x - 5;
                        })
                        .attr("cy", function (d) {
                            return d.y - 5;
                        });

                    label
                        .attr("x", function (d) {
                            return d.x - 13;
                        })
                        .attr("y", function (d) {
                            return d.y;
                        })
                        .style("font-size", "20px").style("fill", "#4393c3");
                }

                function dragstarted() {
                    d3.select(this).raise();
                    g.attr("cursor", "grabbing");
                };

                function dragged(d) {
                    d.x = d3.event.x;
                    d.y = d3.event.y;
                    d3.select(this).attr("cx", d.x).attr("cy", d.y);
                    link.filter(function (l) {
                        return l.source === d;
                    }).attr("x1", d.x).attr("y1", d.y);
                    link.filter(function (l) {
                        return l.target === d;
                    }).attr("x2", d.x).attr("y2", d.y);
                    label.filter(function (l) {
                        return l.id === d.id;
                    }).attr("x", d.x - 13).attr("y", d.y);
                    node.filter(function (n) {
                        return n.id === d.id;
                    }).attr("cx", d.x - 5).attr("cy", d.y - 5);

                };

                function dragended() {
                    g.attr("cursor", "grab");
                };

                function zoomed() {
                    g.attr("transform", d3.event.transform);
                };

            };
        </script>
        <style>
            code {
                    font-size: 15px;
            }
            label {
                    font-size: 15px;
            }
        </style>
        <style>
            .active, .accordion:hover {
              background-color: #ccc;
            }

            .panel {
              padding: 0 18px;
              display: none;
              background-color: white;
              overflow: hidden;
              margin-left: 20px;
              margin-right: 20px;
            }

            .verbose_output {
                height: auto;
                max-height: 400px;
                overflow: auto;
                background-color: #eeeeee;
                word-break: normal !important;
                word-wrap: normal !important;
                white-space: pre !important;
            }
        </style>
        <!-- footer style -->
        <style type="text/css">
            .footer {
               position: fixed;
               left: 14vw;
               bottom: 0;
               width: calc(100vw - 275px);
               padding: 1rem;
               text-align: center;
               background-color: #eee;
               color: #444;
               border: none;
               outline: none;
               font-size: 15px;
               transition: 0.4s;
               margin-left: 20px;
               margin-right: 20px;
               overflow-y: scroll;
            }

            .arrow {
              margin-left: 5px;
              border: solid black;
              border-width: 0 3px 3px 0;
              display: inline-block;
              padding: 3px;
            }

            .up {
              transform: rotate(-135deg);
              -webkit-transform: rotate(-135deg);
            }

            .down {
              transform: rotate(45deg);
              -webkit-transform: rotate(45deg);
            }
        </style>
        <script>
            function pre_init() {
                var loc = window.location.href;
                var url = new URL(loc);
                preset_formula = url.searchParams.get("formula");
                if (preset_formula) {
                    document.getElementById("formula").value = preset_formula;
                }
            }
        </script>
        <style>
            .run_algorithm {
                margin-top: 0.5rem;
            }
            .algorithm_buttons {
                border: 0.5rem outset #716da7;
                border-radius: 12px;
                font: bold 1rem sans-serif;
                margin-top: 0.5rem;
                padding: 0.5rem;
                background: #ebebf3;
            }
            .formula_filters {
                width: 60%;
                margin: 1rem;
                border: 0.5rem outset #87656b;
                border-radius: 12px;
                font: bold 1rem sans-serif;
                padding: 0.5rem;
                outline-offset: 0.5rem;
            }
            .algorithm_cancelations {
                width: 40%;
                margin: 1rem;
                border: 0.5rem outset #87656b;
                border-radius: 12px;
                font: bold 1rem sans-serif;
                padding: 0.5rem;
                outline-offset: 0.5rem;
            }
            .legend {
                margin-left: 1rem;
                border: 0.5rem outset #8d8485;
                box-shadow: 0 0 0 0.3rem #26627a;
                border-radius: 12px;
                padding: 0.4rem;
                outline-offset: 0.5rem;
            }
            .result {
                margin-left: 10px;
                border: 0.5rem outset #87656b;
                border-radius: 12px;
                font: bold 1rem sans-serif;
                padding-left: 0.3rem;
                padding-right: 0.3rem;
            }
        </style>
    </head>
    <body onload="pre_init();">
        <div class="sidenav">
            <a href="./home.html">Home</a>
            <a href="./index.html">App</a>
            <a href="./samples.html">Samples</a>
            <a href="./howto.html">How To</a>
        </div>
        <div>
            <div class="main" style="display: flex; flex-direction: row;">
                <div class="formula_container" style="margin: 20px; display: flex; flex-direction: column; width: 100%">
                    <div>
                        <div style="display: flex; flex-direction: row; align-items: center;">
                            <div class="formula_itself" style="width: 90%; display: flex; flex-direction: row">
                                <span style="margin-right: 0.6rem">Formula:</span><br>
                                <input id="formula" style="width: 100%; height: 20px;"/>
                            </div>
                            <span style="margin-left: 4px;">Status:</span><span id="algorithm_result" class="result">Resting</span>
                        </div>
                        <div class="algorithm_buttons">
                            Algorithms: 
                            <button class="run_algorithm" onclick="create_task('MEASURED_MODEL')" class="computing_element">MEASURED MODEL</button>
                            <!-- <button class="run_algorithm" onclick="create_task('OPTIMIZED_MEASURED_MODEL')" class="computing_element">OPTIMIZED MEASURED MODEL</button> -->
                            <button class="run_algorithm" onclick="create_task('FAST_MODEL')" class="computing_element">FAST MODEL</button>
                            <button class="run_algorithm" onclick="create_task('CONNECTIVITY')" class="computing_element">CONNECTED MODEL</button>
                            <!-- Add killswitch which is only for development so that this line does not be present -->
                            <button class="run_algorithm" onclick="create_task('BRUTEFORCE_MODEL')" class="computing_element">BRUTEFORCE MODEL</button>
                        </div>
                    </div>
                    <div style="display: flex; flex-direction: row;">
                        <div id="formula_filters" class="formula_filters">
                            Formula Filters:<br>
                            <input type="checkbox" id="convert_contact_less_eq_with_same_terms" checked> Convert Contacts in &lt;=<br>
                            <input type="checkbox" id="convert_disjunction_in_contact_less_eq" checked> Split Disjunctions in Atomic Formulas<br>
                            <input type="checkbox" id="reduce_constants" checked> Reduce Contacts<br>
                            <input type="checkbox" id="reduce_contacts_less_eq_with_constants" checked> Reduce Atomic Formulas with Contacts<br>
                            <input type="checkbox" id="remove_double_negation" checked> Remove Double Negations<br>
                        </div>
                        <div class="algorithm_cancelations">
                            If the calculation takes too long, try to cancel it. It might help to optimize the input formula<br>
                            <button style="margin-top:0.5rem" id="cancel_calculation" onclick="cancel_task('valid_op_id')">CANCEL CALCULATION</button>
                        </div>
                    </div>
                    <div style="width: 100%; display: flex; flex-direction: row">
                        <div id="visualization-graph"></div>
                        <div id="result_sets"></div>
                    </div>
                </div>
                <div class="legend" style="margin-left: auto">
                    <h2 style="margin-left: 8px;">Term's legend</h2>
                    <code>0&nbsp;&nbsp;&nbsp;-&nbsp;&#x2205;&nbsp; - </code><label>Empty set constant</label><br>
                    <code>1&nbsp;&nbsp;&nbsp;-&nbsp;W&nbsp; - </code><label>Whole world constant</label><br>
                    <code>-&nbsp;&nbsp;&nbsp;-&nbsp;T<sup>c</sup> - </code><label>Unary Complement</label><br>
                    <code>*&nbsp;&nbsp;&nbsp;-&nbsp;&#x2229;&nbsp; - </code><label>Intersection</label><br>
                    <code>+&nbsp;&nbsp;&nbsp;-&nbsp;&#x222a;&nbsp; - </code><label>Union</label><br>
                    <code>()&nbsp;&nbsp;-&nbsp;() - </code><label>Parentheses</label><br>
                    <h2 style="margin-left: 8px;">Formula's legend</h2>
                    <code>F&nbsp;&nbsp;&nbsp;-&nbsp;&#8869;&nbsp; - </code><label>False constant</label><br>
                    <code>T&nbsp;&nbsp;&nbsp;-&nbsp;&#8868;&nbsp; - </code><label>True constant</label><br>
                    <code>&amp;&nbsp;&nbsp;&nbsp;-&nbsp;&and;&nbsp; - </code><label>Conjunction</label><br>
                    <code>|&nbsp;&nbsp;&nbsp;-&nbsp;&or;&nbsp; - </code><label>Disjunction</label><br>
                    <code>~&nbsp;&nbsp;&nbsp;-&nbsp;&#xac;&nbsp; - </code><label>Negation</label><br>
                    <code>-&gt;&nbsp;&nbsp;-&nbsp;<font size="+1">&#x21d2;</font>&nbsp;&nbsp;-&nbsp;</code><label>Implication</label><br>
                    <code>&lt;-&gt;&nbsp;-&nbsp;<font size="+1">&#x21D4;</font>&nbsp;&nbsp;-&nbsp;</code><label>Equivalence</label><br>
                    <code>C&nbsp;&nbsp;&nbsp;-&nbsp;&#x2201;&nbsp; - </code><label>Contact, <br/>
                         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syntax:</label><code>&nbsp;C(T<sub>1</sub>,&nbsp;T<sub>2</sub>)</code><br>
                    <code>&lt;=&nbsp;&nbsp;-&nbsp;&le;&nbsp; - </code><label>Part Of, <br/>
                         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syntax:</label><code>&nbsp;&lt;=(T<sub>1</sub>,&nbsp;T<sub>2</sub>)</code><br>
                    <code>&lt;=m&nbsp;-&nbsp;&le;<sub>m</sub> - </code><label>Measured Part Of, <br/>
                         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syntax:</label><code>&nbsp;&lt;=m(T<sub>1</sub>,&nbsp;T<sub>2</sub>)</code><br>
                    <code>=0&nbsp;&nbsp;-&nbsp;=0 - </code><label>Syntax suggar for <br/>
                         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zero term, syntax:</label><code>&nbsp;T=0</code><br>
                    <code>()&nbsp;&nbsp;-&nbsp;() - </code><label>Parentheses</label><br>
                </div>
            </div>
            <div class="empty-footer-holder" style="height: 5rem"></div>
            <div class="footer" style="display: none" id="footer-with-logs">
                <div id="hide-output" style="cursor: pointer;"><b>Hide complete output <i class="arrow down" style="margin-bottom: 3px"></i></b></div>
                <pre class="verbose_output" id="verbose_output" style="max-height: 40vh; text-align: left;"></pre>
            </div>
            <div class="footer" id="simple-footer"> 
                <b style="cursor: pointer;">Show complete output <i class="arrow up"style="margin-top: 2px"></i></b>
            </div>
        </div>
        <script type="text/javascript">
            var withLogs = document.getElementById("hide-output");
            var simpleFooter = document.getElementById("simple-footer");
            
            switchFooters = function() {
                var withLogsCurrent = document.getElementById("footer-with-logs");
                var simpleFooterCurrent = document.getElementById("simple-footer");
                if (withLogsCurrent.style.display === "block") {
                    withLogsCurrent.style.display = "none";
                    simpleFooterCurrent.style.display = "block";
                } else {
                    withLogsCurrent.style.display = "block";
                    simpleFooterCurrent.style.display = "none";
                }
            }
            withLogs.addEventListener("click", switchFooters);
            simpleFooter.addEventListener("click", switchFooters);
        </script>
    </body>
</html>
